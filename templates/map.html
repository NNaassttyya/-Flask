<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CityVibe</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css')}}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <style>
        .popup-form {
            padding: 10px;
        }
        .popup-form textarea {
            width: 100%;
            margin-bottom: 10px;
            padding: 5px;
        }
        .popup-form input[type="datetime-local"] {
            width: 100%;
            margin-bottom: 10px;
            padding: 5px;
        }
        .popup-form button {
            background-color: #4CAF50;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .popup-form button:hover {
            background-color: #45a049;
        }

        
        .venue-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #4CAF50;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .venue-icon {
            font-size: 20px;
            line-height: 40px;
            text-align: center;
        }
        
        .user-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 2px solid #2196F3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .user-icon {
            font-size: 16px;
            line-height: 30px;
            text-align: center;
        }
        
        .venue-popup {
            padding: 10px;
        }
        
        .venue-popup h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .venue-popup p {
            margin: 0 0 10px 0;
            color: #666;
        }
        
        .venue-popup button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .venue-popup button:hover {
            background-color: #45a049;
        }

        .filters-panel {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            transition: left 0.3s ease;
            z-index: 1000;
        }

        .filters-panel.show {
            left: 0;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .filter-option {
            margin: 5px 0;
        }

        .filter-option input {
            margin-right: 8px;
        }

        .filter-actions {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }

        .filter-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .apply-filters {
            background: #4CAF50;
            color: white;
        }

        .reset-filters {
            background: #f0f0f0;
            color: #333;
        }

        .map-filter-screen {
            display: flex;
            height: calc(100vh - 80px);
        }

        .sidebar {
            width: 500px;
            background: white;
            padding: 20px;
            overflow-y: auto;
        }

        .map-filter {
            flex: 1;
            position: relative;
        }

        .card {
            width: 100%;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .card-image-container {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
        }

        .card-images {
            width: 100%;
            height: 100%;
            display: flex;
            transition: transform 0.3s ease;
        }

        .card-image-map {
            min-width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
        }

        .heart {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }

        .card > div:last-child {
            padding: 15px;
        }

        .card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .card p {
            margin: 0 0 15px 0;
            color: #666;
        }

        .btn-card {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-card:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
      <header class="header">
            <nav class="navbar">
            <div class="navbar-container">
                            <img src="images/logo.svg" width="50" height="50" alt="Логотип">
                            <a href="#" class="navbar-brand">City vibe</a>
                            <div class="navbar-wrap">
                                <ul class="navbar-menu">
                                    <li><a href="#!" class="active" >Карта</a></li>
                                    <li><a href="maincityvibe.html">Главная</a></li>
                                    <li><a href="support.html">Тех поддержка</a></li>
                                </ul>
                            </div>
                            <a class="entrance" href="#" id="auth-button" onclick="document.getElementById('sign-up'). style.display='block'">Войти</a>
                            <div class="sign-up" id="sign-up">
                                <span class="close" onclick="document.getElementById('sign-up').style.display='none'">&times;</span>

                                <form action="#" class="sign-up-content">
                                    <div class="container-sign">
                                        <h2>City Vibe</h2>
                                        <div class="reg">
                                            <button class="social-button">
                                            <span class="social-icon">
                                              <img src="images/reg-vk.svg" alt="VK Logo">
                                            </span>
                                            <span class="social-text">Вконтакте</span>
                                            </button>
                                            <button class="social-button">
                                            <span class="social-icon">
                                              <img src="images/reg-google.svg" alt="Google Logo">
                                            </span>
                                            <span class="social-text">Google</span>
                                            </button>
                                        </div>
                                        <h4>Или</h4>
                                        <h4><button type="button" class="register" onclick="showRegisterForm()">Зарегестрироваться</button></h4>
                                        <label for="name">Логин</label>
                                        <input type="name" id="name" name="name" placeholder="Ваш логин" required autocomplete="off">

                                        <label for="email">Почта</label>
                                        <input type="email" id="email" name="email" placeholder="Ваша почта" required autocomplete="off">

                                        <label for="pass">Пароль</label>
                                        <input type="password" id="pass" name="pass" placeholder="******" required>

                                        <div class="buttons">
                                            <button type="button" class="cancelBtn" onclick="document.getElementById('sign-up').style.display='none'">Закрыть</button>
                                            <button type="button" class="signUpBtn">Войти</button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <div class="sign-up" id="register-form" style="display: none;">
                                <span class="close" onclick="closeAllModals()">&times;</span>
                                    <div class="sign-up-content">
                                        <div class="container-sign">
                                        <h2>City Vibe</h2>
                                        <form class="register-form">
                                        <label for="reg-login">Логин</label>
                                        <input type="text" id="reg-login" placeholder="Придумайте логин" required>

                                        <label for="reg-password">Пароль</label>
                                        <input type="password" id="reg-password" placeholder="Придумайте пароль" required>

                                        <label for="reg-email">Почта</label>
                                        <input type="email" id="reg-email" placeholder="Ваша почта" required>
                                            <div class="buttons">
                                                <button type="button" class="cancelBtn" onclick="switchToLogin()">Назад</button>
                                                <button type="button" id="auth-button" class="register-btn" onclick="registerUser()">Зарегистрироваться</button>
                                            </div>
                                        </div>
                                        </form>
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </nav>
                </header>

    <div class="map-filter-screen">
        <div class="sidebar">
            <div class="searching-container">
                <form>
                    <input type="textsearch" placeholder="Поиск">
                    <button type="submit">
                        <h4>Найти</h4>
                    </button>
                </form>
            </div>

            <div class="categories">
                <div class="categories-cnt"><img src="{{ url_for('static', filename='images/forkspoon.svg') }}" alt="Рестораны"/><div id="rest">Рестораны</div></div>
                <div class="categories-cnt"><img src="{{ url_for('static', filename='images/glass.svg') }}" alt="Бары"/><div>Бары</div></div>
                <div class="categories-cnt"><img src="{{ url_for('static', filename='images/dance.svg') }}" alt="Клубы"/><div>Клубы</div></div>
                <div class="categories-cnt" id="filterBtn"><img src="{{ url_for('static', filename='images/filter.svg') }}" alt="Фильтр"/><div>Фильтр</div></div>
            </div>

            <h3 id="h3recom">Рекомендуемые</h3>

            <!-- Карточки рекомендаций -->
            <div class="card">
                <div class="card-image-container">
                    <div class="card-images" data-index="0">
                        <div class="card-image-map" style="background-image: url('{{ url_for('static', filename='images/panorama1.jpg') }}');"></div>
                    </div>
                    <span class="heart">❤</span>
                </div>
                <div>
                      <h3>Panorama</h3>
                        <p>Panorama - панорамный ресторан в Екатеринбурге на 50 этаже.<br><strong>Это место посетила группа Rammstein</strong></p>
                        <button class="btn-card" onclick="window.location.href='panorama-page.html'">Подробнее</button>
                </div>
            </div>

            <div class="card">
                <div class="card-image-container">
                    <div class="card-images" data-index="0">
                        <div class="card-image-map" style="background-image: url('{{ url_for('static', filename='images/syrovarnya1.jpg') }}');"></div>
                    </div>
                    <span class="heart">❤</span>
                </div>
                <div>
                      <h3>Сыроварня</h3>
                        <p>Сыроварня - идеальное место для спокойного проведения досуга, деловой или личной встречи, юбилея в большой компании.<br><strong>Это место посетил артист и певец Олег Газманов</strong></p>
                        <button class="btn-card">Подробнее</button>
                </div>
            </div>
                        <div class="card">
                <div class="card-image-container">
                    <div class="card-images" data-index="0">
                        <div class="card-image-map" style="background-image: url('images/ruki-up.webp');"></div>
                    </div>
                    <span class="heart">❤</span>
                </div>
                <div>
                      <h3>Руки Вверх бар</h3>
                        <p>Руки Вверх бар - популярное место для дней рождений и веселых праздничных банкетов. Для именинников действуют специальные выгодные предложения!<br><strong>Это место посетили Руки вверх Отпетые Мошенники, Feduk, Винтаж и др.</strong></p>
                        <button class="btn-card">Подробнее</button>
                </div>
            </div>

            <div class="card">
                <div class="card-image-container">
                    <div class="card-images" data-index="0">
                        <div class="card-image-map" style="background-image: url('images/nebar.webp');"></div>
                    </div>
                    <span class="heart">❤</span>
                </div>
                <div>
                      <h3>Nebar</h3>
                        <p>Nebar — легендарный клуб с двумя танцполами: слева — флирт и коктейли, справа — безумные вечеринки без правил.<br><strong>Это место посетил ведущий Егор Панин</strong></p>
                        <button class="btn-card">Подробнее</button>
                </div>
            </div>

            <div class="card">
                <div class="card-image-container">
                    <div class="card-images" data-index="0">
                        <div class="card-image-map" style="background-image: url('images/ben-hall.webp');"></div>
                    </div>
                    <span class="heart">❤</span>
                </div>
                <div>
                      <h3>Ben Hall</h3>
                        <p>Ben Hall — это бар, паб, ночной клуб и банкетный зал, расположенный в центре города. Он стилизован под старую Англию и предлагает своим гостям широкий выбор пива, а также вкусные бургеры и картошку..<br><strong>Это место посетили Сергей Бабкин из «Пятницы», Евгений Маргулис из «Машины времени» и др.</strong></p>
                        <button class="btn-card">Подробнее</button>
                </div>
            </div>
    </div>

    <div class="filters-panel" id="filtersPanel">
        <div class="filter-section">
            <h4>Сортировка</h4>
            <div class="filter-actions">
                <button class="apply-filters">Применить</button>
                <button class="reset-filters">Сбросить</button>
            </div>

        </div>

        <div class="filter-section">
            <div class="filter-option"><input type="radio" name="sort" id="sort1"> <label for="sort1">Открыто сейчас</label></div>
            <div class="filter-option"><input type="radio" name="sort" id="sort2"> <label for="sort2">С сайтом</label></div>
            <div class="filter-option"><input type="radio" name="sort" id="sort3"> <label for="sort3">Доставка</label></div>
        </div>

        <div class="filter-section">
            <h4>Средний чек</h4>
            <div class="price-range">
                <span>400</span>
                <input type="range" min="400" max="5000" step="100" value="2200" class="slider" id="priceRange">
                <span>5000</span>
            </div>
        </div>

        <div class="filter-section">
            <h4>Вид заведения</h4>
            <div class="filter-option"><input type="checkbox" id="type1"> <label for="type1">Бары</label></div>
            <div class="filter-option"><input type="checkbox" id="type2"> <label for="type2">Клубы</label></div>
            <div class="filter-option"><input type="checkbox" id="type3"> <label for="type3">Рестораны</label></div>
        </div>

        <div class="filter-section">
            <h4>Кухня</h4>
            <div class="filter-option"><input type="checkbox" id="cuisine1"> <label for="cuisine1">Итальянская</label></div>
            <div class="filter-option"><input type="checkbox" id="cuisine2"> <label for="cuisine2">Азиатская</label></div>
            <div class="filter-option"><input type="checkbox" id="cuisine3"> <label for="cuisine3">Европейская</label></div>
        </div>

        <div class="filter-section">
            <h4>Дополнительно</h4>
            <div class="filter-option"><input type="checkbox" id="extra1"> <label for="extra1">Wi-Fi</label></div>
            <div class="filter-option"><input type="checkbox" id="extra2"> <label for="extra2">Vip-зал</label></div>
        </div>

        <div class="filter-section">
            <h4>Рейтинг</h4>
            <div class="filter-option"><input type="radio" name="rating" id="rating1"> <label for="rating1">от 4.5</label></div>
            <div class="filter-option"><input type="radio" name="rating" id="rating2"> <label for="rating2">от 4.0</label></div>
            <div class="filter-option"><input type="radio" name="rating" id="rating3"> <label for="rating3">от 3.5</label></div>
            <div class="filter-option"><input type="radio" name="rating" id="rating4"> <label for="rating4">от 3.0</label></div>
        </div>

    </div>

    <div class="map-filter">
  <script type="text/javascript" charset="utf-8" async 
    src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A1f5175fe759a5c8393b24e3b8c32231fa0fc0a62f3dd4faef3a6f9f501ee3625&amp;width=100%&amp;height=100%&amp;lang=ru_RU&amp;scroll=true">
  </script>
    </div>

    </div>
        <footer>
            <nav class="footer-nav">
                <div class="footer-container">
                    <div class="footer-grid">
                        <div class="nav-section">
                            <h2>Навигация</h2>
                            <ul class="footer-menu">
                                <li><a href="maincityvibe.html">Главная</a></li>
                                <li><a href="restaurants.html">Карта</a></li>
                                <li><a href="support.html">Тех поддержка</a></li>
                            </ul>
                        </div>
        
                        <div class="social-section">
                            <h2>Социальные сети</h2>
                            <ul class="footer-menu-media">
                                <li><a href="#"><img src="images/tg.svg"></a></li>
                                <li><a href="#"><img src="images/tiktok.svg"></a></li>
                                <li><a href="#"><img src="images/stash_telegram.svg"></a></li>
                            </ul>
                        </div>
                        
                        <div class="partners-section">
                            <h2>Партнерам</h2>
                            <ul class="partners-list">
                                <li><a href="mailto:Cityvibe@gmail.com">Cityvibe@gmail.com</a></li>
                                <li><a href="mailto:Cityvibe@gmail.com">Cityvibe@gmail.com</a></li>
                            </ul>
                        </div>
        
                        <div class="contacts-section">
                            <h2>Контакты</h2>
                            <ul class="contacts-list">
                                <li><a href="#">Местоположение</a></li>
                                <li><a href="tel:+79001111111">+7-900-111-11-11</a></li>
                                <li><a href="tel:+79001111111">+7-900-111-11-11</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </footer>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const filterBtn = document.getElementById('filterBtn');
    const filtersPanel = document.getElementById('filtersPanel');
    const mapFilter = document.querySelector('.map-filter');

    filterBtn.addEventListener('click', function() {
        filtersPanel.classList.toggle('show');
        
        // Пересчитываем ширину карты
        if (filtersPanel.classList.contains('show')) {
            mapFilter.style.width = 'calc(60% - 300px)';
        } else {
            mapFilter.style.width = '60%';
        }
    });

    // Обработчики для кнопок фильтров
    document.querySelector('.apply-filters').addEventListener('click', function() {
        // Здесь будет логика применения фильтров
        alert('Фильтры применены!');
    });

    document.querySelector('.reset-filters').addEventListener('click', function() {
        // Сброс всех чекбоксов и радио-кнопок
        const inputs = filtersPanel.querySelectorAll('input');
        inputs.forEach(input => {
            if (input.type === 'checkbox') {
                input.checked = false;
            } else if (input.type === 'radio') {
                input.checked = false;
            } else if (input.type === 'range') {
                input.value = (parseInt(input.max) + parseInt(input.min)) / 2;
            }
        });
    });
});

</script>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        const currentUserId = {{ current_user_id|default('null') }};
        let map;
        let tempMarker = null;
        let points = [];
        let venues = [];
        let venueMarkers = [];

        function initMap() {
            map = L.map('map').setView([55.7558, 37.6173], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    map.setView([latitude, longitude], 13);
                });
            }

            // Обработчик клика по карте для добавления новой точки
            map.on('click', function(e) {
                if (!currentUserId) {
                    alert('Пожалуйста, войдите в систему, чтобы добавлять точки');
                    return;
                }

                const { lat, lng } = e.latlng;

                // Если уже есть временный маркер, удаляем его
                if (tempMarker) {
                    map.removeLayer(tempMarker);
                }

                // Создаем новый временный маркер
                tempMarker = L.marker([lat, lng]).addTo(map);
                tempMarker.bindPopup(`
                    <div class="popup-form">
                        <textarea id="description" placeholder="Что вы здесь делаете?" rows="3"></textarea>
                        <input type="datetime-local" id="endTime">
                        <button onclick="addPoint(${lat}, ${lng})">Добавить точку</button>
                    </div>
                `).openPopup();
            });

            loadVenues();
            loadPoints();
        }

        async function loadVenues() {
            try {
                const response = await fetch('/get_venues');
                venues = await response.json();
                
                // Удаляем старые маркеры заведений
                venueMarkers.forEach(marker => map.removeLayer(marker));
                venueMarkers = [];
                
                // Добавляем новые маркеры заведений
                venues.forEach(venue => {
                    const marker = L.marker([venue.latitude, venue.longitude], {
                        icon: L.divIcon({
                            className: `venue-marker ${venue.venue_type}`,
                            html: `<div class="venue-icon">${getVenueIcon(venue.venue_type)}</div>`,
                            iconSize: [40, 40]
                        })
                    });
                    
                    marker.bindPopup(`
                        <div class="venue-popup">
                            <h3>${venue.name}</h3>
                            <p>${venue.description}</p>
                            <p><strong>Сейчас здесь: ${venue.current_visitors} чел.</strong></p>
                            ${currentUserId ? `
                                <div class="popup-form">
                                    <textarea id="description" placeholder="Что вы здесь делаете?" rows="3"></textarea>
                                    <input type="datetime-local" id="endTime">
                                    <button onclick="addVisitor(${venue.id})">Я тоже здесь!</button>
                                </div>
                            ` : '<p>Войдите, чтобы отметиться здесь</p>'}
                        </div>
                    `);
                    
                    marker.addTo(map);
                    venueMarkers.push(marker);
                });
            } catch (error) {
                console.error('Ошибка при загрузке заведений:', error);
            }
        }

        function getVenueIcon(type) {
            switch(type) {
                case 'restaurant':
                    return '��️';
                case 'bar':
                    return '🍸';
                case 'club':
                    return '💃';
                default:
                    return '📍';
            }
        }

        async function addVisitor(venueId) {
            const description = document.getElementById('description').value;
            const endTime = document.getElementById('endTime').value;

            if (!description || !endTime) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            try {
                const response = await fetch('/add_visitor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        venue_id: venueId,
                        description: description,
                        end_time: endTime
                    })
                });

                if (response.ok) {
                    loadVenues();
                    loadPoints();
                    map.closePopup();
                } else {
                    alert('Ошибка при добавлении отметки');
                }
            } catch (error) {
                console.error('Ошибка:', error);
                alert('Ошибка при добавлении отметки');
            }
        }

        async function addPoint(lat, lng) {
            const description = document.getElementById('description').value;
            const endTime = document.getElementById('endTime').value;

            if (!description || !endTime) {
                alert('Пожалуйста, заполните все поля');
                return;
            }

            try {
                const response = await fetch('/add_point', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        latitude: lat,
                        longitude: lng,
                        description: description,
                        end_time: endTime
                    })
                });

                if (response.ok) {
                    map.removeLayer(tempMarker);
                    tempMarker = null;
                    loadPoints();
                } else {
                    alert('Ошибка при добавлении точки');
                }
            } catch (error) {
                console.error('Ошибка:', error);
                alert('Ошибка при добавлении точки');
            }
        }

        async function loadPoints() {
            try {
                const response = await fetch('/get_points');
                const data = await response.json();
                
                // Удаляем старые точки
                points.forEach(point => map.removeLayer(point));
                points = [];
                
                // Добавляем новые точки
                data.forEach(point => {
                    const marker = L.marker([point.latitude, point.longitude]).bindPopup(`
                        <b>${point.user_login}</b><br>
                        ${point.description}<br>
                        До: ${new Date(point.end_time).toLocaleString()}<br>
                        ${point.user_id === currentUserId ? 
                            `<button onclick="deletePoint(${point.id})">Удалить</button>` : 
                            ''}
                    `);
                    marker.addTo(map);
                    points.push(marker);
                });
            } catch (error) {
                console.error('Ошибка при загрузке точек:', error);
            }
        }

        async function deletePoint(pointId) {
            if (confirm('Вы уверены, что хотите удалить эту точку?')) {
                try {
                    const response = await fetch(`/delete_point/${pointId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        loadPoints();
                    } else {
                        alert('Ошибка при удалении точки');
                    }
                } catch (error) {
                    console.error('Ошибка:', error);
                    alert('Ошибка при удалении точки');
                }
            }
        }

        // Обработчики для категорий
        const categories = document.querySelectorAll('.categories-cnt');
        categories.forEach(category => {
            category.addEventListener('click', () => {
                const type = category.querySelector('div').textContent.toLowerCase();
                category.classList.toggle('active');
                
                // Фильтруем заведения по типу
                venueMarkers.forEach(marker => {
                    const venueType = venues.find(v => 
                        v.latitude === marker.getLatLng().lat && 
                        v.longitude === marker.getLatLng().lng
                    )?.venue_type;
                    
                    if (category.classList.contains('active')) {
                        if (venueType === type) {
                            marker.addTo(map);
                        } else {
                            map.removeLayer(marker);
                        }
                    } else {
                        marker.addTo(map);
                    }
                });
            });
        });

        // Обработчик для кнопки фильтров
        const filterBtn = document.getElementById('filterBtn');
        const filtersPanel = document.getElementById('filtersPanel');
        
        filterBtn.addEventListener('click', () => {
            filtersPanel.classList.toggle('show');
        });

        // Обработчики для кнопок в панели фильтров
        document.querySelector('.apply-filters')?.addEventListener('click', applyFilters);
        document.querySelector('.reset-filters')?.addEventListener('click', resetFilters);

        function applyFilters() {
            const priceRange = document.getElementById('priceRange').value;
            const rating = document.querySelector('input[name="rating"]:checked')?.value;
            const isOpenNow = document.getElementById('delivery1').checked;
            const is24h = document.getElementById('delivery2').checked;
            const selectedTypes = Array.from(document.querySelectorAll('.filter-section:nth-of-type(4) input:checked'))
                .map(input => input.id.replace('type', ''));
            const selectedCuisines = Array.from(document.querySelectorAll('.filter-section:nth-of-type(5) input:checked'))
                .map(input => input.id.replace('cuisine', ''));
            
            // Здесь можно добавить логику фильтрации заведений
            console.log({
                priceRange,
                rating,
                isOpenNow,
                is24h,
                selectedTypes,
                selectedCuisines
            });
        }

        function resetFilters() {
            // Сбрасываем все фильтры
            document.querySelectorAll('.filters-panel input[type="checkbox"]').forEach(input => {
                input.checked = false;
            });
            document.querySelectorAll('.filters-panel input[type="radio"]').forEach(input => {
                input.checked = false;
            });
            document.getElementById('priceRange').value = 2200;
            
            // Показываем все заведения
            venueMarkers.forEach(marker => marker.addTo(map));
        }

        // Автоматическое обновление данных каждые 30 секунд
        setInterval(() => {
            loadVenues();
            loadPoints();
        }, 30000);

        // Инициализация карты при загрузке страницы
        document.addEventListener('DOMContentLoaded', initMap);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
